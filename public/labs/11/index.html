<!doctype html><html lang=en dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Overview
  #

NOTE: This lab is completely optional. Completing it before the late lab
deadline will count as an additional completed, on-time lab (so please try it out
if you weren&rsquo;t able to finish a previous lab)!
This lab is designed to give you some hands-on experience with Kubernetes. By the end of this lab, you should be able to:

Understand the basic components of a Kubernetes deployment, including pods, services, and ingresses
Run your own simple Kubernetes deployment

Keep track of your answers to the questions, as you&rsquo;ll need to submit them to Gradescope."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="http://localhost:1313/labs/11/"><meta property="og:site_name" content="OCF Sysadmin DeCal"><meta property="og:title" content="Lab 11 - Kubernetes"><meta property="og:description" content="Overview # NOTE: This lab is completely optional. Completing it before the late lab deadline will count as an additional completed, on-time lab (so please try it out if you weren’t able to finish a previous lab)!
This lab is designed to give you some hands-on experience with Kubernetes. By the end of this lab, you should be able to:
Understand the basic components of a Kubernetes deployment, including pods, services, and ingresses Run your own simple Kubernetes deployment Keep track of your answers to the questions, as you’ll need to submit them to Gradescope."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="labs"><title>Lab 11 - Kubernetes | OCF Sysadmin DeCal</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=http://localhost:1313/labs/11/><link rel=stylesheet href=/book.min.5d66a598a957a57db9eb1e614a4e20c2bc6f81b607613fa13e31fc22786d762f.css integrity="sha256-XWalmKlXpX256x5hSk4gwrxvgbYHYT+hPjH8Inhtdi8=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.6e640a7b23ef5e54d19a05589bc70221f7d7848f1085842b5f3c8d4d9b8219ea.js integrity="sha256-bmQKeyPvXlTRmgVYm8cCIffXhI8QhYQrXzyNTZuCGeo=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>OCF Sysadmin DeCal</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/syllabus/>Syllabus</a></li><li><input type=checkbox id=section-638171d5990482642c69d9e2d942b1e4 class=toggle>
<label for=section-638171d5990482642c69d9e2d942b1e4 class=flex><a role=button class=flex-auto>Announcements</a></label><ul><li><a href=/announcements/week-0/>Week 0</a></li><li><a href=/announcements/week-1/>Week 1</a></li><li><a href=/announcements/week-2/>Week 2</a></li><li><a href=/announcements/week-3/>Week 3</a></li><li><a href=/announcements/week-4/>Week 4</a></li><li><a href=/announcements/week-5/>Week 5</a></li><li><a href=/announcements/week-6/>Week 6</a></li><li><a href=/announcements/week-7/>Week 7</a></li><li><a href=/announcements/week-8/>Week 8</a></li><li><a href=/announcements/week-9/>Week 9</a></li></ul></li><li><input type=checkbox id=section-70822959fae8f27c0f79dc3a8400cebe class=toggle checked>
<label for=section-70822959fae8f27c0f79dc3a8400cebe class=flex><a role=button class=flex-auto>Labs</a></label><ul><li><a href=/labs/1/>Lab 1 - Unix, the Shell, OSS</a></li><li><a href=/labs/2/>Lab 2 - Core Shell & Shell Scripting</a></li><li><a href=/labs/3/>Lab 3 - Packages and Packaging</a></li><li><a href=/labs/4/>Lab 4 - Processes and Services</a></li><li><a href=/labs/5/>Lab 5 - Introduction to Networking</a></li><li><a href=/labs/6/>Lab 6 - Web Servers</a></li><li><a href=/labs/7/>Lab 7 - Security Fundamentals</a></li><li><a href=/labs/8/>Lab 8 - Version Control and Backups</a></li><li><a href=/labs/9/>Lab 9 - Containers (Docker)</a></li><li><a href=/labs/10/>Lab 10 - Puppet</a></li><li><a href=/labs/11/ class=active>Lab 11 - Kubernetes</a></li><li><a href=/labs/12/>Lab 12 - CUDA</a></li></ul></li><li><a href=/staff/>Staff</a></li><li><a href=/resources/>Resources</a></li></ul><ul><li><a href=https://edstem.org target=_blank rel=noopener>Ed</a></li><li><a href=https://ocf.berkeley.edu target=_blank rel=noopener>OCF</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Lab 11 - Kubernetes</h3><label for=toc-control></label></div></header><article class="markdown book-article"><h2 id=overview>Overview
<a class=anchor href=#overview>#</a></h2><p><strong>NOTE:</strong> This lab is completely optional. Completing it before the late lab
deadline will count as an additional completed, on-time lab (so please try it out
if you weren&rsquo;t able to finish a previous lab)!</p><p>This lab is designed to give you some hands-on experience with Kubernetes. By the end of this lab, you should be able to:</p><ul><li>Understand the basic components of a Kubernetes deployment, including pods, services, and ingresses</li><li>Run your own simple Kubernetes deployment</li></ul><p>Keep track of your answers to the questions, as you&rsquo;ll need to submit them to Gradescope.</p><h2 id=basic-concepts>Basic Concepts
<a class=anchor href=#basic-concepts>#</a></h2><p>For your own future reference, answer the following conceptual questions on Gradescope:</p><p><strong>Question 1a.</strong> In your own words, describe what Kubernetes is, and why it is useful (i.e. what problems it solves).</p><p><strong>Question 1b.</strong> What are some similarities and differences between Kubernetes and Docker?</p><h2 id=resources>Resources
<a class=anchor href=#resources>#</a></h2><p>In addition to the standard &ldquo;just Google it&rdquo; procedure, you can find answers to your many Kubernetes-related questions in the following resources:</p><ul><li><a href=https://kubernetes.io/docs/home/>Kubernetes documentation</a></li><li><a href=https://kubernetes.io/docs/concepts/workloads/controllers/deployment/>Kubernetes deployments</a></li><li><a href=https://nikhiljha.com/posts/kubernetes-intro/>njha&rsquo;s kubernetes intro</a></li><li><a href=https://github.com/ocf/kubernetes>Actual OCF kubernetes deployment</a></li><li><a href=https://kubernetes.io/docs/reference/kubectl/cheatsheet/>kubectl cheatsheet</a></li></ul><h2 id=getting-started-with-kind>Getting started with kind
<a class=anchor href=#getting-started-with-kind>#</a></h2><p><a href=https://kind.sigs.k8s.io>kind</a> (Kubernetes in Docker) is a user-friendly way to run a single-node Kubernetes cluster locally on your computer. A popular alternative (and another valid way to complete this lab) is
<a href=https://minikube.sigs.k8s.io>minikube</a> which provides a variety of other ways to run a single-node Kubernetes cluster if you prefer to not use Docker. We chose to use kind in this guide because it supports IPv6 unlike minikube, and at the moment the VMs we provide are IPv6 only. Other popular Kubernetes distributions include
<a href=https://k3s.io>k3s</a> and
<a href=https://microk8s.io/>microk8s</a>, which are more feature-rich but more involved to set up compared to kind and minikube.</p><p>To begin, you can follow
<a href=https://kind.sigs.k8s.io/docs/user/quick-start/>the official getting started guide</a> for installation instructions (we recommend you install from release binaries).</p><h3 id=installation-notes>Installation notes
<a class=anchor href=#installation-notes>#</a></h3><ul><li>Remember to run <code>sudo usermod -aG docker $USER && newgrp docker</code> if you&rsquo;re getting Docker permissions issues.</li><li>If the <code>kubectl</code> command is not found, follow the
<a href=https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/>instructions</a> to install it.</li></ul><h3 id=confirm-successful-install>Confirm successful install
<a class=anchor href=#confirm-successful-install>#</a></h3><p><strong>Question 2a.</strong> What command can you run to get all pods in all namespaces?</p><p><strong>Question 2b.</strong> What is the output of that command? (<em>hint:</em> &ldquo;No resources found in default namespace.&rdquo; is an <em>incorrect</em> answer- there should be something running if your install was successful)</p><h2 id=creating-your-first-deployment>Creating your first deployment
<a class=anchor href=#creating-your-first-deployment>#</a></h2><p>For this first part, we&rsquo;ll walk through how to set up a simple deployment of
<a href=https://github.com/storax/kubedoom>kubedoom</a> using your new cluster.</p><p>First, you&rsquo;ll want to fetch the source code: <code>git clone https://github.com/storax/kubedoom && cd kubedoom</code>.</p><p>Next, run <code>kubectl apply -k manifest/</code> to create all the resources.</p><p>Once this completes, you should have one new deployment (<code>kubectl get deployments -A</code>) and one new pod (<code>kubectl get pods -A</code>). It may take a couple minutes for the pod to show as &ldquo;ready&rdquo;.</p><p>However, you still won&rsquo;t be able to access this pod from the outside world! In order to do so, we&rsquo;ll need to create a service and expose it:</p><ol><li>Run <code>kubectl expose deployment kubedoom -n kubedoom --type=NodePort --port=5900</code>. This will take the deployment we just made in the namespace <code>kubedoom</code>, and map it to a new service.</li><li>If you now run <code>kubectl get svc -A</code>, you should see a new service of type NodePort listed.</li><li>Port forward the service from your kind container by using <code>kubectl port-forward service/kubedoom 5900 --address '127.0.0.1,::' -n kubedoom</code>. This will allow you to access the service from either your VM at localhost:5900 or from outside with <username>.decal.ocfhosted.com:5900.</li><li>Try running telnet with <code>telnet &lt;username>.decal.ocfhosted.com 5900</code> on your local computer to make sure you can access it!<ul><li>If you&rsquo;re able to connect and it doesn&rsquo;t disconnect you immediately, then it should be working (you can press control-] and then type <code>quit</code> to exit). Use <code>&lt;username>.decal.ocfhosted.com:5900</code> as your VNC address in the next step.</li><li>If you&rsquo;re not able to connect, then you&rsquo;ll probably have to port forward (run <code>ssh &lt;username>@&lt;username>.decal.ocfhosted.com -J &lt;username>@ssh.ocf.berkeley.edu -L 5900:localhost:5900</code> in another window) and then try <code>telnet localhost 5900</code>. If that works then use <code>localhost:5900</code> as your VNC address in the next step.</li></ul></li></ol><p>Finally, let&rsquo;s access our kubedoom instance. The pod is actually running a GUI application, which can be accessed using
<a href=https://en.wikipedia.org/wiki/Virtual_Network_Computing>VNC</a>. You can download your VNC viewer of choice (some popular choices include TigerVNC, TightVNC, and RealVNC) and use the address from the telnet step to connect. The password for the VNC connection is <code>idbehold</code>. If all goes well, you should see a window that looks like this!</p><p><img src=https://github.com/storax/kubedoom/raw/master/assets/doom.jpg alt=kubedoom></p><p><strong>Question 3a.</strong> Upload a screenshot of your working Kubedoom instance. If you were unable to get it to work, describe your debugging journey instead, and where you got stuck.</p><h2 id=helm>Helm
<a class=anchor href=#helm>#</a></h2><p>Since many people have probably needed to deploy the same services that you&rsquo;re hoping to deploy, chances are you&rsquo;ll be able to find all the configurations you need online already!
<a href=https://helm.sh/>Helm</a> is a package manager for Kubernetes, which makes it easy to find and manage these configs. Similarly to a package manager like <code>apt</code> for Linux, Helm will automatically download and install whatever you want it to with a few commands.</p><p>You can install Helm using
<a href=https://helm.sh/docs/intro/install/>this guide</a>.</p><p>Once you&rsquo;ve got it installed, let&rsquo;s create a basic
<a href=https://github.com/Huseyinnurbaki/mocktail>mocktail</a> deployment by following the instructions below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ helm repo add ocf https://decal.ocf.berkeley.edu/helm/
</span></span><span style=display:flex><span>$ helm install mocktail ocf/mocktail
</span></span></code></pre></div><h3 id=extending-helm-deployments>Extending Helm deployments
<a class=anchor href=#extending-helm-deployments>#</a></h3><p>Although taking the default deployment from Helm will be enough in some cases, we might also want to change up the configuration. Fortunately, Helm lets us do this!</p><p><strong>Your task:</strong> Figure out a way to modify Mocktail such that:</p><ul><li>It runs on its own namespace <code>mocktail-space</code>,</li><li>Its name is changed to <code>ocf-mocktail</code>,</li><li>There are a minimum of 3 Mocktail pods running at any time.</li></ul><p><strong>Hints:</strong></p><ol><li>Use the
<a href=https://github.com/Huseyinnurbaki/charts/blob/release/hhaluk/mocktail/values.yaml>default</a> <code>values.yaml</code> file provided by the Mocktail chart maintainers for reference.</li><li>Here&rsquo;s
<a href=https://helm.sh/docs/chart_template_guide/values_files/>some documentation</a> on values files:</li><li>Best practices dictate that you should not specify a custom namespace in the values file. Can you modify the commands you run to get around this?</li><li>You can specify the <code>--dry-run</code> flag to debug without actually committing any changes.</li></ol><p><strong>Question 4a.</strong> If applicable, paste the <code>values.yaml</code> file you created.</p><p><strong>Question 4b.</strong> Paste the command(s) you ran to create your Helm deployment.</p><p><strong>Question 4c.</strong> Paste the output of <code>kubectl get deployments -A</code> showing that your custom namespace appears.</p><p><strong>Question 4d.</strong> Paste the output of <code>kubectl get pods -A</code> showing that you have 3 <code>ocf-mocktail</code> pods running.</p><h2 id=choose-your-own-adventure>Choose your own adventure
<a class=anchor href=#choose-your-own-adventure>#</a></h2><p>At this point, you should hopefully have an idea of how to create deployments and modify them to suit your needs!</p><p>Now, we will provide the opportunity for you to find your own deployment(s) to create- you&rsquo;re welcome to try whatever you find interesting.</p><p><strong>Requirements:</strong> You should host a service on your kind cluster that is externally accessible on your computer through some means (whether that be a GUI like kubedoom, web client like mocktail, or CLI). Document the process you took to install and expose this service.</p><p>Some suggestions include but are not limited to:</p><ul><li>Run your own blog using
<a href=https://artifacthub.io/packages/helm/bitnami/ghost>Ghost</a></li><li>Run your own wiki using
<a href=https://artifacthub.io/packages/helm/outline/outline>Outline</a></li><li>Run a
<a href=https://github.com/solarhess/kubernetes-minecraft-server>Minecraft server</a></li><li>Run
<a href=https://github.com/lucky-sideburn/kubeinvaders>kubeinvaders</a> to stress-test your cluster</li></ul><h3 id=questions>Questions
<a class=anchor href=#questions>#</a></h3><p><strong>Question 5a.</strong> What did you choose to install?</p><p><strong>Question 5b.</strong> Upload a screenshot of your working installation, or describe how/why you got stuck while trying to install it.</p><p><strong>Question 5c.</strong> Document any steps you took and commands you ran to create this deployment.</p><p><strong>Question 5d.</strong> What is one new thing you learned about Kubernetes, Linux, or system administration while creating this deployment?</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><div class="flex flex-wrap justify-between"><span><a href=/labs/10/ class="flex align-center book-icon"><img src=/svg/backward.svg class=book-icon alt=Previous title="Lab 10 - Puppet">
<span>Lab 10 - Puppet</span>
</a></span><span><a href=/labs/12/ class="flex align-center book-icon"><span>Lab 12 - CUDA</span>
<img src=/svg/forward.svg class=book-icon alt=Next title="Lab 12 - CUDA"></a></span></div><div class="col-lg-12 text-center"><p style=display:flex;justify-content:center;align-items:center><a href=https://www.janestreet.com class=no-underline><img src=/jane-street.svg style=height:50px>
</a><span style=padding-left:10px ;>Thanks to
<a href=https://www.janestreet.com>Jane Street</a> for supporting the DeCal.</span></p><p style=display:flex;justify-content:center;align-items:center><a href=https://www.ocf.berkeley.edu class=no-underline><img src=https://www.ocf.berkeley.edu/hosting-logos/ocf-hosted-penguin.svg alt="Hosted by the OCF" style=height:50px style=border:0></a>
<span style=padding-left:10px ;>Copyright &copy; 2017-2025
<a href=https://www.ocf.berkeley.edu>Open Computing Facility </a>and
<a href=https://xcf.berkeley.edu>eXperimental Computing Facility</a></span></p><p><span>This website and its course materials are licensed under the terms of the
<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>CC BY-NC-SA 4.0
</a>License.
<a href=https://github.com/0xcf/decal-web/>Source Code </a>available on GitHub</span></p></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main></body></html>