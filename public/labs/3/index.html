<!doctype html><html lang=en dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Table of contents
  #

{: .no_toc .text-delta }

TOC
{:toc}



  About This Lab
  #


  Grading note
  #

Labs are graded on completion. Treat this lab as seeds of exploration instead
of just a grade.

  Workflow
  #

This lab should be completed on your Linux VM, and not on tsunami. You may need root access for part of the lab.

  Debian: An introduction to apt and dpkg
  #

In this class, we will be focused on using Debian. As noted within this week&rsquo;s lecture, Debian uses apt/dpkg as its package manager. Other distributions use different package managers."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="http://localhost:1313/labs/3/"><meta property="og:site_name" content="Sysadmin DeCal"><meta property="og:title" content="Lab 3 - Packages and Packaging"><meta property="og:description" content="Table of contents # {: .no_toc .text-delta }
TOC {:toc} About This Lab # Grading note # Labs are graded on completion. Treat this lab as seeds of exploration instead of just a grade.
Workflow # This lab should be completed on your Linux VM, and not on tsunami. You may need root access for part of the lab.
Debian: An introduction to apt and dpkg # In this class, we will be focused on using Debian. As noted within this week’s lecture, Debian uses apt/dpkg as its package manager. Other distributions use different package managers."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="labs"><title>Lab 3 - Packages and Packaging | Sysadmin DeCal</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=http://localhost:1313/labs/3/><link rel=stylesheet href=/book.min.a66993900f9437bc8b9f3d67f5fea86cd8f2c5ca3eaecc1e818bb26d7ac89625.css integrity="sha256-pmmTkA+UN7yLnz1n9f6obNjyxco+rswegYuybXrIliU=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.28d1e126de307ffcd3a8254d9f1c14303f0918b2dfde22cc673bdc49855798da.js integrity="sha256-KNHhJt4wf/zTqCVNnxwUMD8JGLLf3iLMZzvcSYVXmNo=" crossorigin=anonymous></script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Sysadmin DeCal</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/about/>About</a></li><li><input type=checkbox id=section-638171d5990482642c69d9e2d942b1e4 class=toggle>
<label for=section-638171d5990482642c69d9e2d942b1e4 class=flex><a role=button class=flex-auto>Announcements</a></label><ul><li><a href=/announcements/week-0/>Week 0</a></li><li><a href=/announcements/week-1/>Week 1</a></li><li><a href=/announcements/week-2/>Week 2</a></li><li><a href=/announcements/week-3/>Week 3</a></li><li><a href=/announcements/week-4/>Week 4</a></li><li><a href=/announcements/week-5/>Week 5</a></li><li><a href=/announcements/week-6/>Week 6</a></li><li><a href=/announcements/week-7/>Week 7</a></li><li><a href=/announcements/week-8/>Week 8</a></li><li><a href=/announcements/week-9/>Week 9</a></li></ul></li><li><input type=checkbox id=section-70822959fae8f27c0f79dc3a8400cebe class=toggle checked>
<label for=section-70822959fae8f27c0f79dc3a8400cebe class=flex><a role=button class=flex-auto>Labs</a></label><ul><li><a href=/labs/1/>Lab 1 - Unix, the Shell, OSS</a></li><li><a href=/labs/2/>Lab 2 - Core Shell & Shell Scripting</a></li><li><a href=/labs/3/ class=active>Lab 3 - Packages and Packaging</a></li><li><a href=/labs/4/>Lab 4 - Processes and Services</a></li><li><a href=/labs/5/>Lab 5 - Introduction to Networking</a></li><li><a href=/labs/6/>Lab 6 - Web Servers</a></li><li><a href=/labs/7/>Lab 7 - Security Fundamentals</a></li><li><a href=/labs/8/>Lab 8 - Version Control and Backups</a></li><li><a href=/labs/9/>Lab 9 - Containers (Docker)</a></li><li><a href=/labs/10/>Lab 10 - Puppet</a></li><li><a href=/labs/11/>Lab 11 - Kubernetes</a></li><li><a href=/labs/12/>Lab 12 - CUDA</a></li></ul></li><li><a href=/staff/>Staff</a></li><li><a href=/resources/>Resources</a></li></ul><ul><li><a href=https://github.com/alex-shpak/hugo-book target=_blank rel=noopener>Ed</a></li><li><a href=https://themes.gohugo.io/themes/hugo-book/ target=_blank rel=noopener>OCF</a></li><li><a href=https://themes.gohugo.io/themes/hugo-book/ target=_blank rel=noopener>Github</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Lab 3 - Packages and Packaging</h3><label for=toc-control></label></div></header><article class="markdown book-article"><h2 id=table-of-contents>Table of contents
<a class=anchor href=#table-of-contents>#</a></h2><p>{: .no_toc .text-delta }</p><ol><li>TOC
{:toc}</li></ol><hr><h2 id=about-this-lab>About This Lab
<a class=anchor href=#about-this-lab>#</a></h2><h3 id=grading-note>Grading note
<a class=anchor href=#grading-note>#</a></h3><p>Labs are graded on completion. Treat this lab as seeds of exploration instead
of just a grade.</p><h3 id=workflow>Workflow
<a class=anchor href=#workflow>#</a></h3><p>This lab should be completed on your Linux VM, and not on tsunami. You may need root access for part of the lab.</p><h2 id=debian-an-introduction-to-apt-and-dpkg>Debian: An introduction to <code>apt</code> and <code>dpkg</code>
<a class=anchor href=#debian-an-introduction-to-apt-and-dpkg>#</a></h2><p>In this class, we will be focused on using Debian. As noted within this week&rsquo;s lecture, Debian uses apt/dpkg as its package manager. Other distributions use different package managers.</p><h3 id=apt><code>apt</code>
<a class=anchor href=#apt>#</a></h3><p>The frontend package manager for Debian is <code>apt</code>. For the majority of times when you need to deal with a package manager, <code>apt</code> is usually the way to go. Before doing anything with <code>apt</code>, it is typically a good habit to update the package list so that the package manager can find and fetch the most updated versions of various packages. To do that, you can run:</p><p><code>apt update</code></p><p>To find a package to install:</p><p><code>apt search [package|description]</code></p><p>To install a package:</p><p><code>apt install [package]</code></p><p>To remove a package:</p><p><code>apt remove [package]</code></p><p>Once you have been using the packages that you installed for a while, you may notice that they don&rsquo;t automatically update themselves, a feature that may be present on programs written for other operating systems. To update the packages that you have installed, run:</p><p><code>apt upgrade</code> or sometimes <code>apt dist-upgrade</code></p><p>It is more commonplace to use <code>apt upgrade</code> to update your packages, but there are times when you need to use <code>apt dist-upgrade</code>. You can read up more about the differences between the two
<a href=https://askubuntu.com/questions/194651/why-use-apt-get-upgrade-instead-of-apt-get-dist-upgrade>here</a>.</p><p>In some circumstances, you want to be absolutely sure of the version of the package that you want to install. To list the potential versions that you can install, you can run:</p><p><code>apt policy [package]</code></p><p>This lists the candidate version to install, according to its pin priority, along with other versions that are compatible with the system. To install a a version for a specific target release, you can run:</p><p><code>apt -t [targetrelease] install [package]</code></p><p>There are also other commands that can remove unneeded dependencies and purge packages, but that is what the <code>man</code> pages are for. Please note that you are going to have to use <code>sudo</code> for the above commands since you are actually modifying the system itself.</p><h3 id=dpkg><code>dpkg</code>
<a class=anchor href=#dpkg>#</a></h3><p>The backend package manager is <code>dpkg</code>. Traditionally, <code>dpkg</code> is used to install local packages. Using <code>dpkg</code>, you also can inspect packages and fix broken installs. To install local packages, run:</p><p><code>dpkg -i [packagefilename]</code></p><p>To remove a system package:</p><p><code>dpkg --remove [package]</code></p><p>To inspect a package for more information about the package:</p><p><code>dpkg -I [packagefilename]</code></p><p>To fix/configure all unpacked but unfinished installs:</p><p><code>dpkg --configure -a</code></p><h2 id=getting-started>Getting Started
<a class=anchor href=#getting-started>#</a></h2><p>We are going to use <code>gcc</code> to compile source code and a simple utility called <code>fpm</code> to create packages in this lab.</p><p>Using the commands above, install <code>gcc</code>, <code>make</code>, <code>ruby-dev</code>, and <code>ruby-ffi</code>.</p><p>Now check if GCC and Ruby are installed by typing the followng:</p><p><code>gcc --version</code></p><p><code>ruby --version</code></p><p>Now install <code>fpm</code> using <code>gem</code>, Ruby’s own package manager:</p><p><code>sudo gem install fpm</code></p><p>Now check if <code>fpm</code> is installed:</p><p><code>fpm</code></p><p>Now clone the <code>decal-labs</code> repository:</p><p><code>git clone https://github.com/0xcf/decal-labs.git</code></p><h2 id=exercise-1-compiling-and-packaging>Exercise 1: Compiling and Packaging
<a class=anchor href=#exercise-1-compiling-and-packaging>#</a></h2><p>Packaging manually for Debian can be very hard and frustrating, especially for first timers. That’s why for this class, we’ll be using a really cool Ruby package called fpm which simplifies the task of packaging a lot.</p><p><strong>Note:</strong> This method is a great way to backport or package your own applications extremely quickly, but is not up to the more formal standards set by the
<a href=https://www.debian.org/doc/manuals/maint-guide/>Debian New Maintainers&rsquo; Guide</a>. If you&rsquo;re up for a challenge, feel free to try following the lab instructions, but using the guidelines
<a href=https://www.debian.org/doc/manuals/maint-guide/build.en.html>here</a> for <code>dpkg-buildpackage</code> instead of using <code>fpm</code>.</p><p>Now we will create a simplistic package using the hellopenguin executable that you will make in the coming steps. First, move into the lab 3 folder in the repository that you cloned in the Getting Started section:</p><p><code>cd decal-labs/3</code></p><p>Now we are going to create a folder to work in for this exercise:</p><p><code>mkdir ex1</code></p><p>And now move into the folder:</p><p><code>cd ex1</code></p><h3 id=writing-and-compiling-the-program>Writing and Compiling the Program
<a class=anchor href=#writing-and-compiling-the-program>#</a></h3><p>Now, we will make a very simple application in C that prints “Hello Penguin!” named hellopenguin. Invoke:</p><p><code>touch hellopenguin.c</code></p><p>This will create an empty file named <code>hellopenguin.c</code>. Now, using the a preferred text editor of your choice, such as <code>vim</code>, <code>emacs</code>, or <code>nano</code>, insert the following code into <code>hellopenguin.c</code></p><pre tabindex=0><code>#include &lt;stdio.h&gt;

int main()

{

   printf(&#34;Hello Penguin!\n&#34;);

   return 0;

}
</code></pre><p>We will now compile the source file that you have just written:</p><p><code>gcc hellopenguin.c -o hellopenguin</code></p><p>What this does is to take in a source file <code>hellopenguin.c</code> and compile it to an executable named <code>hellopenguin</code> with the <code>-o</code> output flag.</p><h3 id=packaging-the-executable>Packaging the executable
<a class=anchor href=#packaging-the-executable>#</a></h3><p>Now, we will create the folder structure of where the executable shall reside in. In Debian, user-level packages usually reside in the folder <code>/usr/bin/</code>:</p><p><code>mkdir -p packpenguin/usr/bin</code></p><p>Now move your compiled <code>hellopenguin</code> exectuable into the <code>packpenguin/usr/bin/</code> folder.</p><p><code>mv hellopenguin packpenguin/usr/bin/</code></p><p>Now we will create a package called <code>hellopenguin</code>. Move into the parent directory of the <code>packpenguin</code> folder and invoke the following:</p><p><code>fpm -s dir -t deb -n hellopenguin -v 1.0~ocf1 -C packpenguin</code></p><p>This specifies that you want to take in a directory, using the <code>-s</code> flag, and to output a <code>.deb</code> package using the <code>-t</code> flag. It takes in a directory called <code>packpenguin</code>, using the <code>-C</code> flag, and output a <code>.deb</code> file named <code>hellopenguin</code>, using the <code>-n</code>, with a version number of <code>1.0~ocf1</code>, using the <code>-v</code> flag.</p><p>Now test it by invoking apt and installing it:</p><p><code>sudo dpkg -i ./hellopenguin_1.0~ocf1_amd64.deb</code></p><p>Note: For m1 users, the package might be <code>hellopenguin_1.0~ocf1_arm64.deb</code></p><p>Now you should be able to run <code>hellopenguin</code> by doing the following:</p><p><code>hellopenguin</code></p><h2 id=exercise-2-troubleshooting>Exercise 2: Troubleshooting
<a class=anchor href=#exercise-2-troubleshooting>#</a></h2><p>Now we are going to try and troubleshoot a package. Move to the other folder, <code>ex2</code>.</p><p>Try installing the <code>ocfspy</code> package using <code>dpkg</code>. It should error. Take note what it is erroring on! Now try and fix it.</p><p><strong>Hint:</strong> Inspect the package for more details. The file to create that application is in the folder. Try compiling and packaging it. Exercise 1 may be a useful reference if you are stuck.</p><p>After you’re done, complete the following questions and made a submission to Gradescope.</p><p><strong>Compiling and packaging</strong></p><ol><li>Will we still be able to run &ldquo;hellopenguin&rdquo; from any directory if we packaged it into &ldquo;/usr/share&rdquo; instead of &ldquo;/usr/bin&rdquo;?</li><li>What is your rationale for the previous answer?</li></ol><p><strong>Debugging</strong></p><ol><li>What package was missing after trying to install ocfspy?</li><li>What is the password that ocfspy outputs after fixing the dependency problem?</li></ol><p>Note that you may want to clean up your VM by removing <code>hellopenguin</code>, <code>ocfdocs</code>, and <code>ocfspy</code> from your system.</p><h2 id=exercise-3-spelunking>Exercise 3: Spelunking
<a class=anchor href=#exercise-3-spelunking>#</a></h2><p>Let&rsquo;s shift gears a bit and take a look at a popular package to learn more about how it&rsquo;s structured! If you recall from
<a href="https://www.youtube.com/watch?v=M0vPXQycer0&amp;feature=youtu.be">lecture</a>, we took at look at the contents of <code>htop</code>. For this next section, choose another package from the Debian repository to download and extract. You can choose any package that you&rsquo;ve used/installed before (such as <code>tmux</code>, <code>sl</code>, or <code>tree</code>), or one from
<a href=https://packages.debian.org/stable/>this list</a>.</p><p>Note that this exercise is mainly for exploration and learning purposes- you wouldn&rsquo;t actually install a package using this method.</p><p><strong>Once you&rsquo;ve extracted the files (using the method shown in lecture), answer the following questions on Gradescope:</strong></p><ol><li>What package did you choose?</li><li>What are the package&rsquo;s dependencies? What file can you find them in?</li><li>Extract <code>data.tar.gz</code> and view its contents. If there exists a folder(s) other than <code>usr/bin/</code> and <code>usr/share/</code>, pick one and briefly describe its purpose (both generally and in the context of this package). If not, explain why additional folders are not needed for this package.</li><li>What&rsquo;s one other interesting thing you learned about this package? (Binaries you never knew existed, easter eggs in documentation, a cool pre-install script&mldr;)</li></ol><p><strong>Hints:</strong></p><ul><li>The command to download a package is <code>apt download &lt;packagename></code>.</li><li>To use <code>aunpack</code>, you might need to <code>sudo apt install atool</code>.</li><li>Try to choose a package with a smaller filesize, so you won&rsquo;t have to wait long for it to download and extract.</li><li>The lecture demo will be quite helpful! You may want to watch it again for reference.</li></ul><h2 id=for-hotshots>For Hotshots
<a class=anchor href=#for-hotshots>#</a></h2><p>In the past examples, we have always precompiled a given program before packaging it. One upside to this, is that the package will always work for systems similar to the one that you run. However, once we start introducing other machines with potentially different architectures, we suddenly need to create duplicate packages compiled specifically for those systems. Create a new package that unpacks the source code for a file, compiles it, moves all of the relevant files to their respective locations, before deleting the irrelevant files.</p><h2 id=resources>Resources
<a class=anchor href=#resources>#</a></h2><p>Below are some resources that I found helpful in the creation of this lab. If you are feeling adventurous, you may want to poke around these documents as well.</p><p><a href=https://github.com/jordansissel/fpm/wiki>fpm</a></p><p><a href=https://tldr.sh/>TLDR pages, a more readable man page</a></p><p><a href=https://linux.die.net/man/1/dpkg>dpkg</a>, alternatively <code>man dpkg</code></p><p><a href=https://linux.die.net/man/8/apt>apt</a>, alternatively <code>man apt</code></p><p><a href=https://www.debian.org/doc/manuals/maint-guide/>Debian New Maintainers&rsquo; Guide</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><div class="flex flex-wrap justify-between"><span><a href=/labs/2/ class="flex align-center book-icon"><img src=/svg/backward.svg class=book-icon alt=Previous title="Lab 2 - Core Shell & Shell Scripting">
<span>Lab 2 - Core Shell & Shell Scripting</span>
</a></span><span><a href=/labs/4/ class="flex align-center book-icon"><span>Lab 4 - Processes and Services</span>
<img src=/svg/forward.svg class=book-icon alt=Next title="Lab 4 - Processes and Services"></a></span></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div></main></body></html>